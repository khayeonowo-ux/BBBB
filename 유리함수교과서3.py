import streamlit as st
import numpy as np
import plotly.graph_objects as go

# =============================
# ì œëª©
# =============================
st.title("ðŸ“˜ ìœ ë¦¬í•¨ìˆ˜ì˜ ê·¸ëž˜í”„ì™€ ì ê·¼ì„ ")

# =============================
# 1ï¸âƒ£ ê°œë… ì„¤ëª…
# =============================
with st.expander("ðŸ“– 1. ìœ ë¦¬í•¨ìˆ˜ì™€ í‰í–‰ì´ë™ì˜ ê°œë…", expanded=True):
    st.markdown("""
    ### ðŸ”¹ ìœ ë¦¬í•¨ìˆ˜ì˜ ê¸°ë³¸í˜•
    ìœ ë¦¬í•¨ìˆ˜ì˜ ëŒ€í‘œì ì¸ í˜•íƒœëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

    \\[
    y = \\frac{a}{x - p} + q
    \\]

    ### ðŸ”¹ ê° ìƒìˆ˜ì˜ ì˜ë¯¸
    - **a** : ê·¸ëž˜í”„ì˜ ëª¨ì–‘  
      - a > 0 â†’ 1, 3ì‚¬ë¶„ë©´  
      - a < 0 â†’ 2, 4ì‚¬ë¶„ë©´  
    - **p** : ê·¸ëž˜í”„ì˜ ì¢Œìš° ì´ë™  
      â†’ **ìˆ˜ì§ ì ê·¼ì„ : x = p**
    - **q** : ê·¸ëž˜í”„ì˜ ìƒí•˜ ì´ë™  
      â†’ **ìˆ˜í‰ ì ê·¼ì„ : y = q**

    ðŸ‘‰ ì¦‰, ìœ ë¦¬í•¨ìˆ˜ì˜ ê·¸ëž˜í”„ëŠ”  
    **ì ê·¼ì„ ì„ ê¸°ì¤€ìœ¼ë¡œ í‰í–‰ì´ë™**í•˜ëŠ” ê·¸ëž˜í”„ìž…ë‹ˆë‹¤.
    """)

# =============================
# 2ï¸âƒ£ ì¡°ì ˆ íŒ¨ë„
# =============================
st.subheader("ðŸŽ›ï¸ ê³„ìˆ˜ ì¡°ì ˆí•˜ê¸°")

col1, col2, col3 = st.columns(3)

with col1:
    a = st.slider("a (ê·¸ëž˜í”„ì˜ ëª¨ì–‘)", -5.0, 5.0, 1.0, 0.1)
with col2:
    p = st.slider("p (ì¢Œìš° ì´ë™ â†’ ìˆ˜ì§ ì ê·¼ì„ )", -5.0, 5.0, 0.0, 0.1)
with col3:
    q = st.slider("q (ìƒí•˜ ì´ë™ â†’ ìˆ˜í‰ ì ê·¼ì„ )", -5.0, 5.0, 0.0, 0.1)

# =============================
# 3ï¸âƒ£ ê·¸ëž˜í”„ ê·¸ë¦¬ê¸°
# =============================
st.subheader("ðŸ“Š ìœ ë¦¬í•¨ìˆ˜ ê·¸ëž˜í”„ì™€ ì ê·¼ì„ ")

x = np.linspace(-10, 10, 600)

# ì •ì˜ë˜ì§€ ì•ŠëŠ” ì  ì œê±°
x_main = x[x != p]
y_main = a / (x_main - p) + q

x_ref = x[x != 0]
y_ref = 1 / x_ref

fig = go.Figure()

# ê¸°ì¤€ í•¨ìˆ˜ y = 1/x
fig.add_trace(go.Scatter(
    x=x_ref,
    y=y_ref,
    mode="lines",
    name="ê¸°ì¤€í•¨ìˆ˜  y = 1/x",
    line=dict(color="gray", dash="dot")
))

# í˜„ìž¬ ìœ ë¦¬í•¨ìˆ˜
fig.add_trace(go.Scatter(
    x=x_main,
    y=y_main,
    mode="lines",
    name="y = a/(x - p) + q",
    line=dict(color="black", width=3)
))

# ìˆ˜ì§ ì ê·¼ì„ 
fig.add_vline(
    x=p,
    line=dict(color="red", dash="dash", width=3),
    annotation_text=f"x = {p:.1f}",
    annotation_position="top"
)

# ìˆ˜í‰ ì ê·¼ì„ 
fig.add_hline(
    y=q,
    line=dict(color="blue", dash="dash", width=3),
    annotation_text=f"y = {q:.1f}",
    annotation_position="right"
)

fig.update_layout(
    title=f"y = {a:.1f}/(x - {p:.1f}) + {q:.1f}",
    xaxis_title="x",
    yaxis_title="y",
    template="plotly_white",
    height=550,
    showlegend=True
)

st.plotly_chart(fig, use_container_width=True)

# =============================
# 4ï¸âƒ£ ê´€ì°° í¬ì¸íŠ¸
# =============================
with st.expander("ðŸ§  4. ê´€ì°° í¬ì¸íŠ¸ (ì¤‘ìš”!)", expanded=True):
    st.markdown(f"""
    ### ðŸ“Œ í˜„ìž¬ ìƒíƒœ
    - í•¨ìˆ˜ì‹:  \\( y = \\frac{{{a:.1f}}}{{x - {p:.1f}}} + {q:.1f} \\)
    - **ìˆ˜ì§ ì ê·¼ì„ **: \\( x = {p:.1f} \\)
    - **ìˆ˜í‰ ì ê·¼ì„ **: \\( y = {q:.1f} \\)

    ### ðŸ” ê´€ì°°í•´ ë³´ì„¸ìš”
    - **p**ë¥¼ ì›€ì§ì´ë©´ â†’ ë¹¨ê°„ ì ê·¼ì„ ì´ ì¢Œìš°ë¡œ ì´ë™  
    - **q**ë¥¼ ì›€ì§ì´ë©´ â†’ íŒŒëž€ ì ê·¼ì„ ì´ ìœ„ì•„ëž˜ë¡œ ì´ë™  
    - ê·¸ëž˜í”„ëŠ” í•­ìƒ **ë‘ ì ê·¼ì„ ì„ ê¸°ì¤€ìœ¼ë¡œ ê°™ì€ ëª¨ì–‘**ì„ ìœ ì§€í•©ë‹ˆë‹¤.
    """)

# =============================
# 5ï¸âƒ£ ì •ë¦¬
# =============================
with st.expander("ðŸ§¾ 5. í•µì‹¬ ì •ë¦¬", expanded=True):
    st.markdown("""
    âœ”ï¸ ìœ ë¦¬í•¨ìˆ˜ì˜ ê·¸ëž˜í”„ëŠ” ì ê·¼ì„ ì„ ì¤‘ì‹¬ìœ¼ë¡œ í‰í–‰ì´ë™í•œë‹¤.  
    âœ”ï¸ ìˆ˜ì§ ì ê·¼ì„ ì€ x = p, ìˆ˜í‰ ì ê·¼ì„ ì€ y = q ì´ë‹¤.  
    âœ”ï¸ ê·¸ëž˜í”„ì˜ ëª¨ì–‘ì€ aê°€ ê²°ì •í•˜ê³ , ìœ„ì¹˜ëŠ” pì™€ qê°€ ê²°ì •í•œë‹¤.
    """)

st.info("ðŸ’¡ ìŠ¬ë¼ì´ë”ë¥¼ í•˜ë‚˜ì”© ì›€ì§ì´ë©° ì ê·¼ì„ ì´ ê·¸ëž˜í”„ì˜ ê¸°ì¤€ì´ ëœë‹¤ëŠ” ì ì„ ê¼­ í™•ì¸í•´ ë³´ì„¸ìš”!")
